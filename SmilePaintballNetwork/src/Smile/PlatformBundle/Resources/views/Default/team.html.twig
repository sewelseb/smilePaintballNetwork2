{% extends "SmilePlatformBundle::Default/layout.html.twig" %}

{% block pageHeader %}
    <H1>{{ team.name }}</H1>
    {%  if team.teamPicture  %}
        <img width="100px" class="img-responsive " src="{{team.teamPicture.uploadDir}}/{{team.teamPicture.url}}" alt="{{ team.name }}">
    {%  endif %}
    {% if app.user %}
        {% if team.admin.id == app.user.id %}
            <button class="btn btn-primary" data-toggle="modal" data-target="#editTeamModal">Edit team</button>
        {% else %}
            {% for user in users %}
                {% if app.user.id == user.id %}
                    <a href="{{ path('smile_platform_leaveTeam', {'teamId': team.Id }) }}">
                        <button class="btn btn-primary">Leave team</button>
                    </a>
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endif %}
    <hr/>


    <div class="modal fade" id="editTeamModal" tabindex="-1" role="dialog" aria-labelledby="editTeamModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Edit team</h4>
                </div>
                <div class="modal-body">
                    {{ render(controller('SmilePlatformBundle:Team:edit', {'id': team.id, 'request': app.request})) }}
                    <div class="clearfix"></div>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
{% endblock %}

{% block leftCollumn %}
    {% for post in posts %}
        <div class="row" >
            <span id="smileApiUpvoteUrl" hidden>{{ path ('smile_api_post_upvote_url') }}</span>
            <span id="smileApiDownvoteUrl" hidden>{{ path ('smile_api_post_downvote_url') }}</span>
            <div class="col-md-7">
                {% if post.type=='video_youtube' %}
                    <iframe  width="100%"  height="300px" ng-src="{{ post.url }}" frameborder="0" allowfullscreen></iframe>
                {% endif %}
                {% if post.type=='video_facebook' %}
                    <div class="fb-video" data-href="{{ post.url }}" data-width="700px" data-show-text="false"><blockquote cite="{{ post.url }}" class="fb-xfbml-parse-ignore"><a href="{{ post.url }}"></a>
                        </blockquote></div>
                {% endif %}
                {% if post.type=='picture_facebook' %}
                    <a href="{{ path('smile_platform_post', {'postId': post.getId })  }}">
                        <div data-width="460px" class="fb-post" data-href="{{ post.url }}"></div>
                    </a>
                {% endif %}
                {% if post.type=='picture_externalUrl' %}
                    <a href="{{ path('smile_platform_post', {'postId': post.getId })  }}">
                        <img class="img-responsive" src="{{ post.url }}" alt="">
                    </a>
                {% endif %}
                {% if post.type=='picture_local' %}
                    <a href="{{ path('smile_platform_post', {'postId': post.getId })  }}">
                        <img class="img-responsive" src="/{{post.picture.uploadDir}}/{{post.picture.url}}" alt="">
                    </a>
                {% endif %}
            </div>
            <div class="col-md-5 ">
                <a href="{{ path('smile_platform_post', {'postId': post.getId })  }}">
                    <h3>{{ post.title }}</h3>
                    <h4>{{ post.eventName }}</h4>
                </a>
                <div>
                    <a href="{{ path('smile_platform_profile', {'userId': post.user.getId })  }}">
                        by
                        {% if post.user.firstName and post.user.lastName %}
                            <strong>{{ post.user.firstName }} {{ post.user.lastName }}</strong><br>
                        {% else %}
                            <strong>{{ post.user.username }}</strong><br>
                        {% endif %}
                    </a>
                </div>

                <div>
                    {% if post.team  %}
                        <a href="/platform/team/{{ post.team.id }}">team: <strong>{{ post.team.name }}</strong></a>
                    {% endif %}
                </div>


                <p>
                <div id="updownVote_{{post.id}}">
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <a href="">
                            <span onclick="upvote({{ post.id }})"><img src="/images/upvote.png" class="vote-img"></span>
                        </a>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <a href="">
                            <span onclick="downvote({{ post.id }})"><img src="/images/downvote.png" class="vote-img"></span>
                        </a>
                    </div>
                </div>
                <div id="upvoted_{{post.id}}" hidden>
                    upvoted ;)
                </div>
                <div id="downvoted_{{post.id}}" hidden>
                    downvoted :(
                </div>
                </p>

                <div>
                    <a href="{{ path('smile_platform_post', {'postId': post.getId })  }}">
                        <span id="post_point_{{ post.id }}">{{ post.upvotes-post.downvotes }}</span> points, {{ post.comments }} comments
                    </a>
                </div>

                <div>
                    <div class="spacer-5px">
                        <div class="fb-share-button"
                             data-href="http://smilepaintball.com/platform/post/{{ post.id }}"
                             data-layout="button_count">
                        </div>
                    </div>
                    <div class="spacer-5px">
                        <a
                                href="https://twitter.com/intent/tweet?text={{post.title}}&url=http://smilepaintball.com/platform/post/{{ post.id }}">
                            <button class="btn twitter-share-button">Tweet</button></a>
                    </div>
                    <div class="spacer-5px">
                        <script type="IN/Share" data-url="http://smilepaintball.com/platform/post/{{ post.id }}" data-counter="right"></script>
                    </div>
                    <div class="spacer-5px">
                        Share: <input class=" form-control input-lg" value="http://smilepaintball.com/platform/post/{{ post.id }}">
                    </div>


                </div>
            </div>


        </div>
        <hr/>
    {% endfor %}
{% endblock %}

{% block rightCollumn %}
    <H2>Team members:</H2>
    {% for user in users %}
        <div class="row">
            <a href="{{ path('smile_platform_profile', {'userId': user.getId }) }}">
                {% if user.picture != null %}
                    <img width="20px" class="img-responsive pull-left" src="{{user.picture.uploadDir}}/{{user.picture.url}}" alt="{{ user.username }}">
                {% endif %}
                {{ user.username }}
            </a>
        </div>
    {% endfor %}
{% endblock %}